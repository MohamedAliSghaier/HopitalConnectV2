{% extends 'base.html.twig' %}

{% block title %}Patient Feedback{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .form-group { margin-bottom: 1em; }
    .form-group label { font-weight: bold; }
    .form-group input, .form-group textarea { width: 100%; padding: 10px; font-size: 16px; }
    .form-group button { padding: 10px 20px; background-color: #FD7170; border: none; color: white; cursor: pointer; }
    .form-group button:hover { background-color: #E36C64; }
</style>

<div class="example-wrapper">
    <h1>Submit Feedback or Complaint</h1>

    <p>Use the form below to leave a review (Avis) or a complaint (Reclamation) regarding your recent appointment.</p>

    <h3>Leave a Review (Avis)</h3>
    <form method="POST" action="{{ path('submit_avis') }}">
        <div class="form-group">
            <label for="rating">Rating (1-5)</label>
            <input type="number" id="rating" name="rating" min="1" max="5" required />
        </div>

        <div class="form-group">
            <label for="comment">Comment</label>
            <textarea id="comment" name="comment" rows="4" required></textarea>
        </div>

        <div class="form-group">
            <button type="submit">Submit Review</button>
        </div>
    </form>

    <h3>Recent Reviews and Complaints</h3>
    
    <h4>Reviews</h4>
    <ul>
        {% for avis in avisList %}
            <li>
                <strong>Rating:</strong> {{ avis.note }}<br>
                <strong>Comment:</strong> {{ avis.commentaire }}

                <!-- Edit button for Avis -->
                <button onclick="toggleEditForm('avis', {{ avis.id }})">Edit</button>

                <!-- Edit form for Avis (hidden by default) -->
                <div id="edit-form-avis-{{ avis.id }}" class="edit-form" style="display:none;">
                    <form method="POST" action="{{ path('edit_avis', {'id': avis.id}) }}">
                        <div class="form-group">
                            <label for="rating-{{ avis.id }}">Rating (1-5)</label>
                            <input type="number" id="rating-{{ avis.id }}" name="rating" value="{{ avis.note }}" min="1" max="5" required />
                        </div>

                        <div class="form-group">
                            <label for="comment-{{ avis.id }}">Comment</label>
                            <textarea id="comment-{{ avis.id }}" name="comment" rows="4" required>{{ avis.commentaire }}</textarea>
                        </div>

                        <div class="form-group">
                            <button type="submit">Save Changes</button>
                        </div>
                    </form>
                </div>

                <!-- Delete button for Avis -->
                <form method="POST" action="{{ path('delete_avis', {'id': avis.id}) }}" style="display:inline;">
                    <button type="submit" onclick="return confirm('Are you sure you want to delete this review?')">Delete</button>
                </form>
            </li>
        {% else %}
            <li>No reviews yet.</li>
        {% endfor %}
    </ul>

    <h4>Complaints</h4>
    <ul>
        {% for reclamation in reclamationList %}
            <li>
                <strong>Issue:</strong> {{ reclamation.description }}

                <!-- Edit button for Reclamation -->
                <button onclick="toggleEditForm('reclamation', {{ reclamation.id }})">Edit</button>

                <!-- Edit form for Reclamation (hidden by default) -->
                <div id="edit-form-reclamation-{{ reclamation.id }}" class="edit-form" style="display:none;">
                    <form method="POST" action="{{ path('edit_reclamation', {'id': reclamation.id}) }}">
                        <div class="form-group">
                            <label for="description-{{ reclamation.id }}">Issue Description</label>
                            <textarea id="description-{{ reclamation.id }}" name="description" rows="4" required>{{ reclamation.description }}</textarea>
                        </div>

                        <div class="form-group">
                            <button type="submit">Save Changes</button>
                        </div>
                    </form>
                </div>

                <!-- Delete button for Reclamation -->
                <form method="POST" action="{{ path('delete_reclamation', {'id': reclamation.id}) }}" style="display:inline;">
                    <button type="submit" onclick="return confirm('Are you sure you want to delete this complaint?')">Delete</button>
                </form>
            </li>
        {% else %}
            <li>No complaints yet.</li>
        {% endfor %}
    </ul>
</div>

<script>
    function toggleEditForm(type, id) {
        var editForm = document.getElementById("edit-form-" + type + "-" + id);
        if (editForm.style.display === "none" || editForm.style.display === "") {
            editForm.style.display = "block";
        } else {
            editForm.style.display = "none";
        }
    }
</script>

{% endblock %}
